<!DOCTYPE html>
<html>
    <head>
        <title>Web Page </title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">
        <script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
        <script src="https:/maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.css">
        <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/bootstrap-table.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.10.1/locale/bootstrap-table-zh-CN.min.js"></script>
        <link rel="shortcut icon" href="">
    </head>
    <body>
        <div class="container">
            <p></p>
            <div class="well">Web Page</div>
            <div class="row">
                <div class="col-xs-6"><div class="well"> <button id="btn_post">POST</button></div></div>
                <div class="col-xs-6"><div class="well"> <button id="btn_xml">Get XML Table</button></div></div>                
            </div>
            <div> <table id="table"></table> </div>
        </div>
        
        
            <!-- Modal -->
        <div class="modal fade" id="myModalHorizontal" tabindex="-1" role="dialog" 
             aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <!-- Modal Header -->
                    <div class="modal-header">
                        <button type="button" class="close" 
                           data-dismiss="modal">
                               <span aria-hidden="true">&times;</span>
                               <span class="sr-only">Close</span>
                        </button>
                        <h4 class="modal-title" id="myModalLabel">
                            Modal title
                        </h4>
                    </div>

                    <!-- Modal Body -->
                    <div class="modal-body">

                        <form class="form-horizontal" role="form">
                          <div class="form-group">
                            <label  class="col-sm-2 control-label"
                                      for="inputEmail3">Email</label>
                            <div class="col-sm-10">
                                <input type="email" class="form-control" 
                                id="inputEmail3" placeholder="Email"/>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="col-sm-2 control-label"
                                  for="inputPassword3" >Password</label>
                            <div class="col-sm-10">
                                <input type="password" class="form-control"
                                    id="inputPassword3" placeholder="Password"/>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                              <div class="checkbox">
                                <label>
                                    <input type="checkbox"/> Remember me
                                </label>
                              </div>
                            </div>
                          </div>
                          <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                              <button type="submit" class="btn btn-default">Sign in</button>
                            </div>
                          </div>
                        </form>
                    </div>

                    <!-- Modal Footer -->
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">
                            Close
                        </button>
                        <button type="button" class="btn btn-primary">
                            Save changes
                        </button>
                    </div>
                </div>
            </div>
        </div>
            
            
            
    <script>
        $('#btn_xml').click(function(){ 
            $.ajax({  
                type: "GET",  
                url:"http://localhost:8080/BatchMvnWeb/webresources/home/getAllBatch", 
                dataType:"json",
                success: function(data){  
                    alert("Success:\n"); 
                    var table_data =data;
                    $('#table').bootstrapTable({
                        columns: [{
                                    field: 'CODE',
                                    title: 'Code'
                                    }, {
                                        field: 'NAME',
                                        title: 'Name'
                                    }, {
                                        field: 'DESCRIPTION',
                                        title: 'Description',
                                    },{
                                        field: 'OUTPUT',
                                        title: 'Output'
                                    },{
                                        field: 'operation',
                                        title: 'Operation',
                                        formatter:function(value,row,index){
                                            var btn = '<button class = "save" > RUN Batch File  </button>  ';
                                            return btn;
                                        },
                                        events: 'operateEvents'
                                    }],
                        data: table_data
                    });
                },  
                error: function(data){  
                    alert('Error: ' + data);  
                }  
            });
        });    
       
        $('#btn_post').click(function(){
            alert("first step");
            $.ajax({
            type : "POST",
            url : "http://localhost:8080/BatchMvnWeb/webresources/home/postMessage",
            data : JSON.stringify( {
                    "author": "11:10pm",
                    "created": "2016-05-30T13:00:19.676",
                    "message": "1:14pm"
            }),
            headers: { 
            'Accept': 'application/json',
            'Content-Type': 'application/json' 
            },
            success:function(result){
                alert("success!");
                alert(JSON.stringify(result));
            },
            error:function(result){
                alert("wrong: ");
            }
            });
        });
       
        window.operateEvents = {
            'click .save': function (e, value, row, index) {
                alert('Success load events! value is '+ value +',\n row is '+ JSON.stringify(row)
                        + ',\n e is '+ e +',\n index is '+index);
                
                var obj = JSON.parse(JSON.stringify(row)); //get JSON data
                var code = obj.CODE;
                var name = obj.NAME;
                var output = obj.OUTPUT;
                var input = obj.INPUT;
                var null_input = JSON.stringify(input).substr(1,JSON.stringify(input).length-2);
                //if input is null, JSON will give us '{}'. so null_input will give us ' '
                //then we use this null_input to judge.
                
                if(null_input !== ''){
                    var input_length = Object.keys(input.PARAM).length;
                    alert('input length is' + input_length);
                    console.log('input_length is '+ input_length);
                    document.getElementById("myModalLabel").value = 'Code is '+ code;
                    
                    $('#myModalLabel').val("asv");
                    $('#myModalHorizontal').modal('show');
                
                }
                else{
                    alert('Since input is null, so we execute immediately!');
                    $.ajax({
                    url: "http://localhost:8080/BatchMvnWeb/webresources/home/runBatch",
                    type: 'POST',
                    dataType: 'text',
                    data: JSON.stringify(row),
                    headers: { 
                        'Accept': 'text/plain',
                        'Content-Type': 'application/json' 
                    },
                    success:function(result){
                        alert("success! result is " + JSON.stringify(result));
                    },
                    error:function(result){
                        alert("wrong: "+ JSON.stringify(result));
                    }
                })
                }
                
                if(input === 'anc' ){
                    
                }else{
                    
                    
                    
                    
                    //funtion showPopup(){
                      //  $find().show();
                    //}
                    
                    //function closePopup(){
                      //  $find().hide();
                    //}
                    
                }
                    
                
                
            }
        };
    </script>
    </body>
</html>
